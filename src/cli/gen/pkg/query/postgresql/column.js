export function column(s) {
  s.build(
    s.query(
      s.select(
        s.as(
          'columns.column_name',
          'name'
        ),
        s.as(
          'columns.udt_name',
          'type'
        ),
        s.as(
          s.eq(
            'columns.is_nullable',
            s.value('NO')
          ),
          'required'
        ),
        s.as(
          'columns.character_maximum_length',
          'maxlength'
        ),
        s.as(
          s.query(
            s.select((box, data) => {
              return `pg_catalog.col_description(${data.oid},columns.ordinal_position)`;
            })
          ).parens(),
          'comment'
        ),
        s.as(
          s.query(
            s.select(
              s.gt(
                s.count('*'),
                0
              )
            ),
            s.from('information_schema.key_column_usage'),
            s.where(
              s.and(
                s.like(
                  'key_column_usage.constraint_name',
                  s.value('%_pkey')
                ),
                s.eq(
                  'key_column_usage.table_name',
                  'columns.table_name'
                ),
                s.eq(
                  'key_column_usage.column_name',
                  'columns.column_name'
                )
              )
            )
          ).parens(),
          'pk'
        ),
        s.as(
          s.query(
            s.select(
              s.stringAgg(
                'enumlabel',
                s.value(',')
              )
            ),
            s.from('pg_type'),
            s.join('pg_enum'),
            s.on(
              s.eq(
                'pg_enum.enumtypid',
                'pg_type.oid'
              )
            ),
            s.where(
              s.eq(
                'pg_type.typname',
                'information_schema.columns.udt_name'
              )
            )
          ).parens(),
          'values'
        )
      ),
      s.from('information_schema.columns'),
      s.where(
        s.eq(
          'columns.table_name',
          s.value((box, data) => data.name)
        )
      )
    )
  );
}
